{"ast":null,"code":"\"use client\";import{useState,useRef,useEffect,useCallback}from\"react\";import{Button}from\"./ui/button\";import{useLanguage}from\"../contexts/language-context\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";// Placeholder functions for Mapbox API integration\nconst getMapboxToken=async()=>{// In a real implementation, this would fetch the token from your API or environment\nreturn process.env.REACT_APP_MAPBOX_TOKEN||\"\";};const searchLocation=async query=>{// In a real implementation, this would use Mapbox Geocoding API\nif(!query||query.length<3)return[];try{const token=await getMapboxToken();if(!token)return[];const response=await fetch(\"https://api.mapbox.com/geocoding/v5/mapbox.places/\".concat(encodeURIComponent(query),\".json?access_token=\").concat(token,\"&country=SA&limit=5\"));const data=await response.json();return data.features||[];}catch(error){console.error(\"Error searching location:\",error);return[];}};const reverseGeocode=async(lng,lat)=>{// In a real implementation, this would use Mapbox Reverse Geocoding API\ntry{var _data$features,_data$features$;const token=await getMapboxToken();if(!token)return null;const response=await fetch(\"https://api.mapbox.com/geocoding/v5/mapbox.places/\".concat(lng,\",\").concat(lat,\".json?access_token=\").concat(token));const data=await response.json();return((_data$features=data.features)===null||_data$features===void 0?void 0:(_data$features$=_data$features[0])===null||_data$features$===void 0?void 0:_data$features$.place_name)||null;}catch(error){console.error(\"Error reverse geocoding:\",error);return null;}};export default function MapboxInput(_ref){let{placeholder,value,onChange}=_ref;const[showMap,setShowMap]=useState(false);const[searchQuery,setSearchQuery]=useState(value);const[suggestions,setSuggestions]=useState([]);const[isSearching,setIsSearching]=useState(false);const[mapboxToken,setMapboxToken]=useState(\"\");const mapContainerRef=useRef(null);const mapRef=useRef(null);const markerRef=useRef(null);const{language}=useLanguage();useEffect(()=>{getMapboxToken().then(setMapboxToken);},[]);const handleReverseGeocode=useCallback(async(lng,lat)=>{try{const address=await reverseGeocode(lng,lat);if(address){setSearchQuery(address);onChange(address,[lng,lat]);}}catch(error){console.error(\"[v0] Error reverse geocoding:\",error);}},[onChange]);// Initialize Mapbox\nuseEffect(()=>{if(showMap&&mapContainerRef.current&&!mapRef.current&&mapboxToken){// Dynamically import mapbox-gl\nimport(\"mapbox-gl\").then(mapboxgl=>{mapboxgl.default.accessToken=mapboxToken;const map=new mapboxgl.default.Map({container:mapContainerRef.current,style:\"mapbox://styles/mapbox/streets-v12\",center:[46.6753,24.7136],// Riyadh coordinates\nzoom:11});const marker=new mapboxgl.default.Marker({draggable:true,color:\"#10b981\"}).setLngLat([46.6753,24.7136]).addTo(map);marker.on(\"dragend\",async()=>{const lngLat=marker.getLngLat();await handleReverseGeocode(lngLat.lng,lngLat.lat);});map.on(\"click\",async e=>{marker.setLngLat([e.lngLat.lng,e.lngLat.lat]);await handleReverseGeocode(e.lngLat.lng,e.lngLat.lat);});mapRef.current=map;markerRef.current=marker;});}return()=>{if(mapRef.current){mapRef.current.remove();mapRef.current=null;}};},[showMap,mapboxToken,handleReverseGeocode]);const handleSearch=async query=>{setIsSearching(true);try{const results=await searchLocation(query);setSuggestions(results);}catch(error){console.error(\"[v0] Error searching location:\",error);setSuggestions([]);}finally{setIsSearching(false);}};const handleSuggestionClick=suggestion=>{const address=suggestion.place_name;const coordinates=suggestion.center;setSearchQuery(address);onChange(address,coordinates);setSuggestions([]);if(mapRef.current&&markerRef.current){mapRef.current.flyTo({center:coordinates,zoom:14});markerRef.current.setLngLat(coordinates);}};const handleConfirm=()=>{setShowMap(false);};return/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:searchQuery,onChange:e=>{setSearchQuery(e.target.value);onChange(e.target.value);handleSearch(e.target.value);},placeholder:placeholder,className:\"w-full px-4 py-3 \".concat(language===\"ar\"?\"pr-24\":\"pl-24\",\" bg-[#F5F5F5] border border-gray-200 rounded-lg \").concat(language===\"ar\"?\"text-right\":\"text-left\",\" focus:outline-none focus:ring-2 focus:ring-[#3BA776] text-gray-700 placeholder-gray-500\")}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowMap(!showMap),className:\"absolute \".concat(language===\"ar\"?\"left-2\":\"right-2\",\" top-1/2 -translate-y-1/2 bg-[#3BA776] hover:bg-[#35996B] text-white px-4 py-1.5 rounded-md text-sm transition-colors\"),children:language===\"ar\"?\"خريطة\":\"Map\"}),suggestions.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute z-50 w-full mt-2 bg-white rounded-lg shadow-xl border border-gray-200 max-h-60 overflow-y-auto\",children:suggestions.map((suggestion,index)=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSuggestionClick(suggestion),className:\"w-full px-4 py-3 text-right hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-b-0\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-2\",children:[/*#__PURE__*/_jsxs(\"svg\",{className:\"w-4 h-4 text-emerald-600 mt-1 flex-shrink-0\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z\"}),/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 11a3 3 0 11-6 0 3 3 0 016 0z\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-700\",children:suggestion.place_name})]})},index))}),isSearching&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute z-50 w-full mt-2 bg-white rounded-lg shadow-xl border border-gray-200 p-4 text-center text-gray-600\",children:\"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u0628\\u062D\\u062B...\"}),showMap&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4 animate-fade-in\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden shadow-2xl\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-b border-gray-200 flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold text-gray-800\",children:\"\\u0627\\u062E\\u062A\\u0631 \\u0627\\u0644\\u0645\\u0648\\u0642\\u0639 \\u0639\\u0644\\u0649 \\u0627\\u0644\\u062E\\u0631\\u064A\\u0637\\u0629\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowMap(false),className:\"p-2 hover:bg-gray-100 rounded-lg transition-colors\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M6 18L18 6M6 6l12 12\"})})})]}),/*#__PURE__*/_jsx(\"div\",{ref:mapContainerRef,className:\"w-full h-[500px]\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-t border-gray-200 flex gap-3\",children:[/*#__PURE__*/_jsx(Button,{onClick:handleConfirm,className:\"flex-1 bg-emerald-600 hover:bg-emerald-700\",children:\"\\u062A\\u0623\\u0643\\u064A\\u062F \\u0627\\u0644\\u0645\\u0648\\u0642\\u0639\"}),/*#__PURE__*/_jsx(Button,{onClick:()=>setShowMap(false),variant:\"outline\",className:\"flex-1\",children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"})]})]})})]});}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}